package com.web.ddentist.hospital.manage.empInfo.controller;

import java.util.HashMap;
import java.util.List;
import java.util.Map;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.ResponseBody;

import com.web.ddentist.hospital.manage.empInfo.service.ITxManagementService;
import com.web.ddentist.vo.DrugVO;
import com.web.ddentist.vo.TxCodeVO;

import lombok.extern.slf4j.Slf4j;

/**
 * 병원 관리 메뉴 - 처치 관리 페이지
 * @author 송지훈
 *
 */
@Slf4j
@RequestMapping("hospital/txCode")
@Controller
public class TxManagementController {
	
	@Autowired
	ITxManagementService txManagementService;
	
	@GetMapping("")
	public String main(Model model) {
		
		//초기 리스트 가져오기
		List<TxCodeVO> list = this.txManagementService.list();
		
		model.addAttribute("txCodeList", list);
		
		return "hospital/txManagement";
	}
	
	//요청URI : /hospital/txCode/insertPost
	@ResponseBody
	@PostMapping("/insertPost")
//	public Map<String, Object> insertPost(@ModelAttribute TxCodeVO txCodeVO) {
	public Map<String, Object> insertPost(@RequestBody TxCodeVO txCodeVO) {
		log.info("추가하기 왔다!");
		//TxCodeVO(txcCd=s1234, txcNm=불면증, txcPrice=230000)
		log.info("txCodeVO : " + txCodeVO);
		
		int result = this.txManagementService.insert(txCodeVO);

		Map<String, Object> map = new HashMap<String, Object>();
		
		if(result>0) {
//			map.put("txCodeList", list);
			
			map.put("message","성공적으로 추가되었습니다.");
			
			map.put("txCodeVO", txCodeVO);
			
			
		}
		return map;
		
	}
	
	//요청URI : /hospital/txCode/deletePost
	@ResponseBody
	@PostMapping("/deletePost")
	public Map<String, Object> deletePost(@RequestBody TxCodeVO txCodeVO) {
		log.info("삭제하기 왔다!");
		//TxCodeVO(txcCd=s1234, txcNm=불면증, txcPrice=230000)
		log.info("txCodeVO : " + txCodeVO);
		
		int result = this.txManagementService.deletePost(txCodeVO);

		Map<String, Object> map = new HashMap<String, Object>();
		
		if(result>0) {
			
			map.put("txCodeVO", txCodeVO);
			
			map.put("message","성공적으로 삭제되었습니다.");
			
		}
		
		return map;
		
	}
	
	//요청URI : /hospital/txCode/updatePost
	@ResponseBody
	@PostMapping("/updatePost")
	public Map<String, Object> updatePost(@RequestBody TxCodeVO txCodeVO) {
		log.info("수정하기 왔다!");
		//TxCodeVO(txcCd=s1234, txcNm=불면증, txcPrice=230000)
		log.info("txCodeVO : " + txCodeVO);
		
		int result = this.txManagementService.updatePost(txCodeVO);
		
		Map<String, Object> map = new HashMap<String, Object>();
		
		if(result>0) {
			
			map.put("message","성공적으로 수정되었습니다.");
			
			log.info("txCodeVO jsp로 보내기 전 : " + txCodeVO);
			
			map.put("txCodeVO", txCodeVO);
		}
		
		return map;
		
	}
	
	//요청URI : /hospital/txCode/doubleCheck
	@ResponseBody
	@GetMapping("/doubleCheck")
	public Map<String, String> doubleCheck(@RequestParam String txcCd) {
		log.info("controller txcCd : " + txcCd);
		String message = "";
		//있는지 조회하기
		int result = this.txManagementService.detail(txcCd);
		log.info("result count : " + result);
		
		if(result>0) {
			message ="*아이디를 사용할 수 없습니다.";
		}else {
			message ="*아이디를 사용할 수 있습니다.";
			
		}
		log.info("message : " + message);
		
		Map<String, String> map = new HashMap<String, String>();
		map.put("message", message);
		
		
		return map;
	}
	
	//요청 URI :/hospital/txCode/drugDetail?drugNum="+drugNum
	@ResponseBody
	@GetMapping("/drugDetail")
	public DrugVO drugDetail(@RequestParam int drugNum) {
		log.info("drugNum : " + drugNum);
		
		DrugVO vo = this.txManagementService.drugDetail(drugNum);
		log.info("vo : " + vo);
		
		return vo;
		
		
	}
	
}
